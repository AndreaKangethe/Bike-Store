{% extends 'store/base.html' %}
{% load humanize %}  {# Load humanize for intcomma filter #}
{% load custom_filters %}

{% block title %}{{ bike.brand }} - {{ bike.name }} {{ bike.model }}{% endblock %}

{% block content %}
<style>
    body {
        color: #F5F5F5; /* Soft white for contrast */
        background-color: #121212; /* Dark background */
    }
    h1, h3, h4, p {
        color: #E0E0E0; /* Light gray for better readability */
    }
    .content-container {
        background: rgba(0, 0, 0, 0.6); /* Dark overlay */
        padding: 20px;
        border-radius: 10px;
    }
    .btn-primary {
        background-color: #4A6FA5; /* Darker blue */
        border-color: #4A6FA5;
    }
    .btn-primary:hover {
        background-color: #003366; /* Deep blue hover effect */
    }
</style>

<div class="row content-container">
    <!-- Bike Image -->
    <div class="col-md-6">
        <img src="{{ bike.image.url|default:'/static/default-bike.jpg' }}" class="img-fluid rounded" alt="{{ bike.name }}">
    </div>

    <!-- Bike Details -->
    <div class="col-md-6">
        <h1>{{ bike.brand }} - {{ bike.name }} {{ bike.model }}</h1>
        <p>{{ bike.description }}</p>
        <h4>Engine CC: {{ bike.engine_cc }}</h4>
        <h4>Price: Ksh {{ bike.price|intcomma }}</h4>

        {% if bike.available %}
            <a href="{% url 'add_to_cart' bike.id %}" class="btn btn-success">Add to Cart</a>
        {% else %}
            <button class="btn btn-secondary" disabled>Out of Stock</button>
        {% endif %}
    </div>
</div>

<!-- Overall Ratings Section -->
<h3 class="mt-5">Customer Rating</h3>
{% with avg_rating=reviews|average_rating %}
    {% if avg_rating > 0 %}
        <p>
            {% for _ in ""|ljust:avg_rating %}‚≠ê{% endfor %}
            ({{ avg_rating }}/5)
        </p>
    {% else %}
        <p style="color: #F5F5F5;">No ratings yet.</p>
    {% endif %}
{% endwith %}

<!-- Individual Reviews Section -->
<h3 class="mt-4">Customer Reviews</h3>
{% for review in reviews %}
    <div class="card mb-3" style="max-width: 600px; background-color: #1e1e1e; color: #F5F5F5;">
        <div class="card-body">
            <h5 class="card-title">{{ review.user.username }}</h5>
            <p class="card-text d-inline">  
                {% for _ in ""|ljust:review.rating %}‚≠ê{% endfor %}
            </p>
            <p class="card-text text-truncate" style="max-width: 100%;">{{ review.comment }}</p>
        </div>
    </div>
{% empty %}
    <p>No reviews yet.</p>
{% endfor %}


<!-- Review Submission Form -->
{% if user.is_authenticated %}
<h3 class="mt-4">Leave a Review & Rating</h3>
<form method="POST" action="{% url 'add_review' bike.id %}" class="mt-3">
    {% csrf_token %}

    <div class="mb-3">
        <label for="rating" class="form-label">Rating</label>
        <select name="rating" id="rating" class="form-select w-25">
            <option value="1">1 - Poor</option>
            <option value="2">2 - Fair</option>
            <option value="3">3 - Good</option>
            <option value="4">4 - Very Good</option>
            <option value="5" selected>5 - Excellent</option>
        </select>
    </div>

    <div class="mb-3">
        <label for="comment" class="form-label">Your Review</label>
        <textarea name="comment" id="comment" class="form-control" rows="2" maxlength="25" required></textarea>
    </div>

    <!-- Submit Button -->
    <button type="submit" class="btn btn-primary w-100">üöÄ Submit Review & Rating</button>
</form>
{% else %}
    <p><a href="{% url 'login' %}">Log in</a> to leave a review and rating.</p>
{% endif %}

{% endblock %}
